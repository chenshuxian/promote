"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/user";
exports.ids = ["pages/api/user"];
exports.modules = {

/***/ "./pages/api/user.js":
/*!***************************!*\
  !*** ./pages/api/user.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n\nconst prisma = new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nasync function handler(req, res) {\n  const q = req.body.q;\n  const api = req.body.api;\n  let status;\n\n  if (req.method === \"POST\") {\n    // 查詢狀態\n    if (api === \"checkStatus\") {\n      status = 99;\n\n      try {\n        const user = await prisma.apply.findUnique({\n          where: {\n            id: q\n          },\n          select: {\n            status: true\n          }\n        });\n\n        if (user) {\n          status = user.status;\n        }\n\n        return res.status(200).send({\n          title: \"處理進度\",\n          status\n        });\n      } catch (err) {\n        console.log(err);\n\n        if (err.code === \"P2002\") {\n          return res.status(400).json({\n            title: \"申請失敗\",\n            msg: \"此身份證已經被申請，請確認輸入是否有誤\"\n          });\n        }\n\n        return res.status(400).send(\"建檔失敗\");\n      }\n    } // 確認用戶名與銀行戶是否相同\n\n\n    if (api === \"checkName\") {\n      // console.log(\"checkName\");\n      let msg = \"銀行戶名必預與申請人相同\";\n      let is_same = 0;\n      let same;\n\n      try {\n        const user = await prisma.apply.findMany({\n          where: {\n            AND: [{\n              name: {\n                equals: q.name\n              }\n            }, {\n              id: {\n                equals: q.id\n              }\n            }]\n          },\n          select: {\n            name: true\n          }\n        });\n        same = Object.keys(user).length; // 戶名和申請人相同\n\n        if (same) {\n          msg = \"申請者與銀行戶名相同\";\n          is_same = 1; // console.log(\"update\" + update);\n\n          msg = \"申請人與銀行戶同相同\";\n        } else {\n          is_same = 0;\n        }\n\n        if (q.id) {\n          const update = await prisma.apply.updateMany({\n            where: {\n              AND: [{\n                status: {\n                  lte: 1\n                }\n              }, {\n                id: {\n                  equals: q.id\n                }\n              }]\n            },\n            data: {\n              is_same_name: is_same\n            }\n          });\n        }\n\n        return res.status(200).send({\n          is_same,\n          msg\n        });\n      } catch (err) {\n        console.log(err);\n\n        if (err.code === \"P2002\") {\n          return res.status(400).json({\n            title: \"申請失敗\",\n            msg: \"此身份證已經被申請，請確認輸入是否有誤\"\n          });\n        }\n\n        return res.status(400).send(\"建檔失敗\");\n      }\n    }\n  } else {\n    res.status(200).json({\n      name: \"John Doe GET\"\n    });\n  }\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWdlcy9hcGkvdXNlci5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBLE1BQU1DLE1BQU0sR0FBRyxJQUFJRCx3REFBSixFQUFmO0FBRWUsZUFBZUUsT0FBZixDQUF1QkMsR0FBdkIsRUFBNEJDLEdBQTVCLEVBQWlDO0FBQzlDLFFBQU1DLENBQUMsR0FBR0YsR0FBRyxDQUFDRyxJQUFKLENBQVNELENBQW5CO0FBQ0EsUUFBTUUsR0FBRyxHQUFHSixHQUFHLENBQUNHLElBQUosQ0FBU0MsR0FBckI7QUFDQSxNQUFJQyxNQUFKOztBQUVBLE1BQUlMLEdBQUcsQ0FBQ00sTUFBSixLQUFlLE1BQW5CLEVBQTJCO0FBQ3pCO0FBQ0EsUUFBSUYsR0FBRyxLQUFLLGFBQVosRUFBMkI7QUFDekJDLE1BQUFBLE1BQU0sR0FBRyxFQUFUOztBQUNBLFVBQUk7QUFDRixjQUFNRSxJQUFJLEdBQUcsTUFBTVQsTUFBTSxDQUFDVSxLQUFQLENBQWFDLFVBQWIsQ0FBd0I7QUFDekNDLFVBQUFBLEtBQUssRUFBRTtBQUNMQyxZQUFBQSxFQUFFLEVBQUVUO0FBREMsV0FEa0M7QUFJekNVLFVBQUFBLE1BQU0sRUFBRTtBQUNOUCxZQUFBQSxNQUFNLEVBQUU7QUFERjtBQUppQyxTQUF4QixDQUFuQjs7QUFTQSxZQUFJRSxJQUFKLEVBQVU7QUFDUkYsVUFBQUEsTUFBTSxHQUFHRSxJQUFJLENBQUNGLE1BQWQ7QUFDRDs7QUFFRCxlQUFPSixHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCUSxJQUFoQixDQUFxQjtBQUMxQkMsVUFBQUEsS0FBSyxFQUFFLE1BRG1CO0FBRTFCVCxVQUFBQTtBQUYwQixTQUFyQixDQUFQO0FBSUQsT0FsQkQsQ0FrQkUsT0FBT1UsR0FBUCxFQUFZO0FBQ1pDLFFBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixHQUFaOztBQUNBLFlBQUlBLEdBQUcsQ0FBQ0csSUFBSixLQUFhLE9BQWpCLEVBQTBCO0FBQ3hCLGlCQUFPakIsR0FBRyxDQUFDSSxNQUFKLENBQVcsR0FBWCxFQUFnQmMsSUFBaEIsQ0FBcUI7QUFDMUJMLFlBQUFBLEtBQUssRUFBRSxNQURtQjtBQUUxQk0sWUFBQUEsR0FBRyxFQUFFO0FBRnFCLFdBQXJCLENBQVA7QUFJRDs7QUFDRCxlQUFPbkIsR0FBRyxDQUFDSSxNQUFKLENBQVcsR0FBWCxFQUFnQlEsSUFBaEIsQ0FBcUIsTUFBckIsQ0FBUDtBQUNEO0FBQ0YsS0FoQ3dCLENBa0N6Qjs7O0FBQ0EsUUFBSVQsR0FBRyxLQUFLLFdBQVosRUFBeUI7QUFDdkI7QUFDQSxVQUFJZ0IsR0FBRyxHQUFHLGNBQVY7QUFDQSxVQUFJQyxPQUFPLEdBQUcsQ0FBZDtBQUNBLFVBQUlDLElBQUo7O0FBQ0EsVUFBSTtBQUNGLGNBQU1mLElBQUksR0FBRyxNQUFNVCxNQUFNLENBQUNVLEtBQVAsQ0FBYWUsUUFBYixDQUFzQjtBQUN2Q2IsVUFBQUEsS0FBSyxFQUFFO0FBQ0xjLFlBQUFBLEdBQUcsRUFBRSxDQUNIO0FBQ0VDLGNBQUFBLElBQUksRUFBRTtBQUNKQyxnQkFBQUEsTUFBTSxFQUFFeEIsQ0FBQyxDQUFDdUI7QUFETjtBQURSLGFBREcsRUFNSDtBQUNFZCxjQUFBQSxFQUFFLEVBQUU7QUFDRmUsZ0JBQUFBLE1BQU0sRUFBRXhCLENBQUMsQ0FBQ1M7QUFEUjtBQUROLGFBTkc7QUFEQSxXQURnQztBQWV2Q0MsVUFBQUEsTUFBTSxFQUFFO0FBQ05hLFlBQUFBLElBQUksRUFBRTtBQURBO0FBZitCLFNBQXRCLENBQW5CO0FBb0JBSCxRQUFBQSxJQUFJLEdBQUdLLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZckIsSUFBWixFQUFrQnNCLE1BQXpCLENBckJFLENBc0JGOztBQUNBLFlBQUlQLElBQUosRUFBVTtBQUNSRixVQUFBQSxHQUFHLEdBQUcsWUFBTjtBQUNBQyxVQUFBQSxPQUFPLEdBQUcsQ0FBVixDQUZRLENBR1I7O0FBQ0FELFVBQUFBLEdBQUcsR0FBRyxZQUFOO0FBQ0QsU0FMRCxNQUtPO0FBQ0xDLFVBQUFBLE9BQU8sR0FBRyxDQUFWO0FBQ0Q7O0FBRUQsWUFBSW5CLENBQUMsQ0FBQ1MsRUFBTixFQUFVO0FBQ1IsZ0JBQU1tQixNQUFNLEdBQUcsTUFBTWhDLE1BQU0sQ0FBQ1UsS0FBUCxDQUFhdUIsVUFBYixDQUF3QjtBQUMzQ3JCLFlBQUFBLEtBQUssRUFBRTtBQUNMYyxjQUFBQSxHQUFHLEVBQUUsQ0FDSDtBQUNFbkIsZ0JBQUFBLE1BQU0sRUFBRTtBQUNOMkIsa0JBQUFBLEdBQUcsRUFBRTtBQURDO0FBRFYsZUFERyxFQU1IO0FBQ0VyQixnQkFBQUEsRUFBRSxFQUFFO0FBQ0ZlLGtCQUFBQSxNQUFNLEVBQUV4QixDQUFDLENBQUNTO0FBRFI7QUFETixlQU5HO0FBREEsYUFEb0M7QUFlM0NzQixZQUFBQSxJQUFJLEVBQUU7QUFDSkMsY0FBQUEsWUFBWSxFQUFFYjtBQURWO0FBZnFDLFdBQXhCLENBQXJCO0FBbUJEOztBQUVELGVBQU9wQixHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCUSxJQUFoQixDQUFxQjtBQUMxQlEsVUFBQUEsT0FEMEI7QUFFMUJELFVBQUFBO0FBRjBCLFNBQXJCLENBQVA7QUFJRCxPQTFERCxDQTBERSxPQUFPTCxHQUFQLEVBQVk7QUFDWkMsUUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVlGLEdBQVo7O0FBQ0EsWUFBSUEsR0FBRyxDQUFDRyxJQUFKLEtBQWEsT0FBakIsRUFBMEI7QUFDeEIsaUJBQU9qQixHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCYyxJQUFoQixDQUFxQjtBQUMxQkwsWUFBQUEsS0FBSyxFQUFFLE1BRG1CO0FBRTFCTSxZQUFBQSxHQUFHLEVBQUU7QUFGcUIsV0FBckIsQ0FBUDtBQUlEOztBQUNELGVBQU9uQixHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCUSxJQUFoQixDQUFxQixNQUFyQixDQUFQO0FBQ0Q7QUFDRjtBQUNGLEdBN0dELE1BNkdPO0FBQ0xaLElBQUFBLEdBQUcsQ0FBQ0ksTUFBSixDQUFXLEdBQVgsRUFBZ0JjLElBQWhCLENBQXFCO0FBQUVNLE1BQUFBLElBQUksRUFBRTtBQUFSLEtBQXJCO0FBQ0Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3Byb21vdGUvLi9wYWdlcy9hcGkvdXNlci5qcz8yYWJiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFByaXNtYUNsaWVudCB9IGZyb20gXCJAcHJpc21hL2NsaWVudFwiO1xuY29uc3QgcHJpc21hID0gbmV3IFByaXNtYUNsaWVudCgpO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHEgPSByZXEuYm9keS5xO1xuICBjb25zdCBhcGkgPSByZXEuYm9keS5hcGk7XG4gIGxldCBzdGF0dXM7XG5cbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiUE9TVFwiKSB7XG4gICAgLy8g5p+l6Kmi54uA5oWLXG4gICAgaWYgKGFwaSA9PT0gXCJjaGVja1N0YXR1c1wiKSB7XG4gICAgICBzdGF0dXMgPSA5OTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEuYXBwbHkuZmluZFVuaXF1ZSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIGlkOiBxLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgICBzdGF0dXM6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICBzdGF0dXMgPSB1c2VyLnN0YXR1cztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMCkuc2VuZCh7XG4gICAgICAgICAgdGl0bGU6IFwi6JmV55CG6YCy5bqmXCIsXG4gICAgICAgICAgc3RhdHVzLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICBpZiAoZXJyLmNvZGUgPT09IFwiUDIwMDJcIikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICB0aXRsZTogXCLnlLPoq4vlpLHmlZdcIixcbiAgICAgICAgICAgIG1zZzogXCLmraTouqvku73orYnlt7LntpPooqvnlLPoq4vvvIzoq4vnorroqo3ovLjlhaXmmK/lkKbmnInoqqRcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoXCLlu7rmqpTlpLHmlZdcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8g56K66KqN55So5oi25ZCN6IiH6YqA6KGM5oi25piv5ZCm55u45ZCMXG4gICAgaWYgKGFwaSA9PT0gXCJjaGVja05hbWVcIikge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJjaGVja05hbWVcIik7XG4gICAgICBsZXQgbXNnID0gXCLpioDooYzmiLblkI3lv4XpoJDoiIfnlLPoq4vkurrnm7jlkIxcIjtcbiAgICAgIGxldCBpc19zYW1lID0gMDtcbiAgICAgIGxldCBzYW1lO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHByaXNtYS5hcHBseS5maW5kTWFueSh7XG4gICAgICAgICAgd2hlcmU6IHtcbiAgICAgICAgICAgIEFORDogW1xuICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgbmFtZToge1xuICAgICAgICAgICAgICAgICAgZXF1YWxzOiBxLm5hbWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgICBlcXVhbHM6IHEuaWQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgc2FtZSA9IE9iamVjdC5rZXlzKHVzZXIpLmxlbmd0aDtcbiAgICAgICAgLy8g5oi25ZCN5ZKM55Sz6KuL5Lq655u45ZCMXG4gICAgICAgIGlmIChzYW1lKSB7XG4gICAgICAgICAgbXNnID0gXCLnlLPoq4vogIXoiIfpioDooYzmiLblkI3nm7jlkIxcIjtcbiAgICAgICAgICBpc19zYW1lID0gMTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcInVwZGF0ZVwiICsgdXBkYXRlKTtcbiAgICAgICAgICBtc2cgPSBcIueUs+iri+S6uuiIh+mKgOihjOaItuWQjOebuOWQjFwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlzX3NhbWUgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHEuaWQpIHtcbiAgICAgICAgICBjb25zdCB1cGRhdGUgPSBhd2FpdCBwcmlzbWEuYXBwbHkudXBkYXRlTWFueSh7XG4gICAgICAgICAgICB3aGVyZToge1xuICAgICAgICAgICAgICBBTkQ6IFtcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICBzdGF0dXM6IHtcbiAgICAgICAgICAgICAgICAgICAgbHRlOiAxLFxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIGlkOiB7XG4gICAgICAgICAgICAgICAgICAgIGVxdWFsczogcS5pZCxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgIGlzX3NhbWVfbmFtZTogaXNfc2FtZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLnNlbmQoe1xuICAgICAgICAgIGlzX3NhbWUsXG4gICAgICAgICAgbXNnLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICBpZiAoZXJyLmNvZGUgPT09IFwiUDIwMDJcIikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICB0aXRsZTogXCLnlLPoq4vlpLHmlZdcIixcbiAgICAgICAgICAgIG1zZzogXCLmraTouqvku73orYnlt7LntpPooqvnlLPoq4vvvIzoq4vnorroqo3ovLjlhaXmmK/lkKbmnInoqqRcIixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoXCLlu7rmqpTlpLHmlZdcIik7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbmFtZTogXCJKb2huIERvZSBHRVRcIiB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlByaXNtYUNsaWVudCIsInByaXNtYSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJxIiwiYm9keSIsImFwaSIsInN0YXR1cyIsIm1ldGhvZCIsInVzZXIiLCJhcHBseSIsImZpbmRVbmlxdWUiLCJ3aGVyZSIsImlkIiwic2VsZWN0Iiwic2VuZCIsInRpdGxlIiwiZXJyIiwiY29uc29sZSIsImxvZyIsImNvZGUiLCJqc29uIiwibXNnIiwiaXNfc2FtZSIsInNhbWUiLCJmaW5kTWFueSIsIkFORCIsIm5hbWUiLCJlcXVhbHMiLCJPYmplY3QiLCJrZXlzIiwibGVuZ3RoIiwidXBkYXRlIiwidXBkYXRlTWFueSIsImx0ZSIsImRhdGEiLCJpc19zYW1lX25hbWUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./pages/api/user.js\n");

/***/ }),

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("./pages/api/user.js"));
module.exports = __webpack_exports__;

})();